<?xml version="1.0" encoding="utf-8" ?>
<ContentPage
    x:Class="WellMind.Views.HomePage"
    xmlns="http://schemas.microsoft.com/dotnet/2021/maui"
    xmlns:x="http://schemas.microsoft.com/winfx/2009/xaml"
    xmlns:controls="clr-namespace:WellMind.Views.Controls"
    x:Name="HomePageView"
    Title="Home">
    <ContentPage.Resources>
        <ResourceDictionary>
            <Color x:Key="AccentGreen">#2F8F5A</Color>
            <Color x:Key="AccentGreenDark">#7BD8A9</Color>
            <Color x:Key="Gray200">#C8C8C8</Color>
            <Color x:Key="Gray600">#404040</Color>
        </ResourceDictionary>
    </ContentPage.Resources>

    <Grid>
        <BoxView
            Color="{Binding BackgroundColor}"
            IsVisible="{Binding ShowBackgroundColor}" />

        <ScrollView>
            <VerticalStackLayout Padding="24" Spacing="16">
            <!-- Header -->
            <Label
                Text="WellMind"
                Style="{DynamicResource Headline}"
                HorizontalOptions="Start"
                TextColor="{AppThemeBinding Light=#2F8F5A, Dark=#00E676}" />
            <HorizontalStackLayout Spacing="8" VerticalOptions="Center">
                <Label
                    Text="{Binding GreetingText}"
                    Style="{DynamicResource DateHeadline}"
                    FontSize="15"
                    VerticalOptions="Center" />
                <Label
                    Text="✨ Personalize"
                    TextColor="{AppThemeBinding Light={DynamicResource Gray500}, Dark={DynamicResource Gray200}}"
                    FontSize="12"
                    VerticalOptions="Center">
                    <Label.GestureRecognizers>
                        <TapGestureRecognizer Command="{Binding OpenBackgroundMenuCommand}" />
                    </Label.GestureRecognizers>
                </Label>
            </HorizontalStackLayout>
            <Label Text="{Binding TodayDateText}" Style="{DynamicResource DateHeadline}" HorizontalOptions="Start" />
            <Label Text="{Binding SummaryText}" Style="{DynamicResource BodyText}" />
            <!-- Tone pack -->
            <VerticalStackLayout Spacing="8">
                <Label Text="Tone for today" Style="{DynamicResource SectionTitle}" />
                <Label Text="{Binding TonePackStatusText}" Style="{DynamicResource CaptionText}" />
                <ScrollView Orientation="Horizontal">
                    <HorizontalStackLayout Spacing="8">
                        <Button
                            Text="Grounding"
                            Style="{DynamicResource TonePackOptionButton}"
                            Command="{Binding SetTonePackCommand}"
                            CommandParameter="grounding">
                            <Button.Triggers>
                                <DataTrigger TargetType="Button" Binding="{Binding IsGroundingToneSelected}" Value="True">
                                    <Setter Property="BackgroundColor" Value="{DynamicResource Primary}" />
                                    <Setter Property="TextColor" Value="{DynamicResource White}" />
                                    <Setter Property="FontAttributes" Value="Bold" />
                                </DataTrigger>
                            </Button.Triggers>
                        </Button>
                        <Button
                            Text="Focus"
                            Style="{DynamicResource TonePackOptionButton}"
                            Command="{Binding SetTonePackCommand}"
                            CommandParameter="focus">
                            <Button.Triggers>
                                <DataTrigger TargetType="Button" Binding="{Binding IsFocusToneSelected}" Value="True">
                                    <Setter Property="BackgroundColor" Value="{DynamicResource Primary}" />
                                    <Setter Property="TextColor" Value="{DynamicResource White}" />
                                    <Setter Property="FontAttributes" Value="Bold" />
                                </DataTrigger>
                            </Button.Triggers>
                        </Button>
                        <Button
                            Text="Recovery"
                            Style="{DynamicResource TonePackOptionButton}"
                            Command="{Binding SetTonePackCommand}"
                            CommandParameter="recovery">
                            <Button.Triggers>
                                <DataTrigger TargetType="Button" Binding="{Binding IsRecoveryToneSelected}" Value="True">
                                    <Setter Property="BackgroundColor" Value="{DynamicResource Primary}" />
                                    <Setter Property="TextColor" Value="{DynamicResource White}" />
                                    <Setter Property="FontAttributes" Value="Bold" />
                                </DataTrigger>
                            </Button.Triggers>
                        </Button>
                        <Button
                            Text="Confidence"
                            Style="{DynamicResource TonePackOptionButton}"
                            Command="{Binding SetTonePackCommand}"
                            CommandParameter="confidence">
                            <Button.Triggers>
                                <DataTrigger TargetType="Button" Binding="{Binding IsConfidenceToneSelected}" Value="True">
                                    <Setter Property="BackgroundColor" Value="{DynamicResource Primary}" />
                                    <Setter Property="TextColor" Value="{DynamicResource White}" />
                                    <Setter Property="FontAttributes" Value="Bold" />
                                </DataTrigger>
                            </Button.Triggers>
                        </Button>
                    </HorizontalStackLayout>
                </ScrollView>
            </VerticalStackLayout>

            <!-- Daily check-in -->
            <Border
                BackgroundColor="{AppThemeBinding Light={DynamicResource Secondary}, Dark={DynamicResource Gray900}}"
                StrokeShape="RoundRectangle 12"
                Padding="16">
                <VerticalStackLayout Spacing="8">
                    <Label Text="Daily check-in" Style="{DynamicResource SectionTitle}" />
                    <Label Text="A 30-second pulse on how you feel today." Style="{DynamicResource CaptionText}" />
                    <Button Text="{Binding PrimaryActionText}" Command="{Binding PrimaryActionCommand}" />
                </VerticalStackLayout>
            </Border>

            <!-- Today's check-in -->
            <Border
                BackgroundColor="{AppThemeBinding Light={DynamicResource Gray100}, Dark={DynamicResource Gray900}}"
                StrokeShape="RoundRectangle 12"
                Padding="12"
                IsVisible="{Binding HasTodayCheckIn}">
                <VerticalStackLayout Spacing="8">
                    <Label Text="Today's check-in" Style="{DynamicResource SectionTitle}" />
                    <Grid ColumnDefinitions="*,Auto" RowDefinitions="Auto,Auto,Auto,Auto" ColumnSpacing="12" RowSpacing="6">
                        <Label Text="Energy" Style="{DynamicResource CaptionText}" />
                        <Label Text="{Binding TodayEnergyValue}" Grid.Column="1" FontAttributes="Bold" />
                        <Label Text="Stress" Style="{DynamicResource CaptionText}" Grid.Row="1" />
                        <Label Text="{Binding TodayStressValue}" Grid.Row="1" Grid.Column="1" FontAttributes="Bold" />
                        <Label Text="Focus" Style="{DynamicResource CaptionText}" Grid.Row="2" />
                        <Label Text="{Binding TodayFocusValue}" Grid.Row="2" Grid.Column="1" FontAttributes="Bold" />
                        <Label Text="Sleep" Style="{DynamicResource CaptionText}" Grid.Row="3" />
                        <Label Text="{Binding TodaySleepValue}" Grid.Row="3" Grid.Column="1" FontAttributes="Bold" />
                    </Grid>
                </VerticalStackLayout>
            </Border>

            <Border
                BackgroundColor="{AppThemeBinding Light={DynamicResource Gray100}, Dark={DynamicResource Gray900}}"
                StrokeShape="RoundRectangle 12"
                Padding="12"
                IsVisible="{Binding HasNoTodayCheckIn}">
                <Label Text="No check-in yet today." Style="{DynamicResource CaptionText}" />
            </Border>

            <!-- Weekly trends -->
            <Label Text="This week" Style="{DynamicResource SectionTitle}" />
            <CollectionView ItemsSource="{Binding Trends}">
                <CollectionView.ItemsLayout>
                    <GridItemsLayout Orientation="Vertical" Span="2" HorizontalItemSpacing="12" VerticalItemSpacing="12" />
                </CollectionView.ItemsLayout>
                <CollectionView.ItemTemplate>
                    <DataTemplate>
                        <Border
                            BackgroundColor="{AppThemeBinding Light={DynamicResource Gray100}, Dark={DynamicResource Gray900}}"
                            StrokeShape="RoundRectangle 12"
                            Padding="12"
                            Margin="0">
                            <VerticalStackLayout Spacing="6">
                                <Label Text="{Binding Label}" FontAttributes="Bold" FontSize="14" />
                                <Label Text="{Binding Summary}" FontSize="12" TextColor="{AppThemeBinding Light={DynamicResource Gray500}, Dark={DynamicResource Gray200}}" />
                                <Label
                                    FontSize="12"
                                    TextColor="{AppThemeBinding Light={DynamicResource Gray500}, Dark={DynamicResource Gray200}}">
                                    <Label.FormattedText>
                                        <FormattedString>
                                            <Span Text="Last: " />
                                            <Span Text="{Binding LastValue}" />
                                        </FormattedString>
                                    </Label.FormattedText>
                                </Label>
                              <Label
                                    FontSize="12"
                                    TextColor="{AppThemeBinding Light={DynamicResource Gray500}, Dark={DynamicResource Gray200}}">
                                    <Label.FormattedText>
                                        <FormattedString>
                                            <Span Text="Range: " />
                                            <Span Text="{Binding Min}" />
                                            <Span Text="–" />
                                            <Span Text="{Binding Max}" />
                                        </FormattedString>
                                    </Label.FormattedText>
                                </Label>
                            </VerticalStackLayout>
                        </Border>
                    </DataTemplate>
                </CollectionView.ItemTemplate>
            </CollectionView>

            <!-- Energy Windows -->
            <Border
                BackgroundColor="{AppThemeBinding Light={DynamicResource Gray100}, Dark={DynamicResource Gray900}}"
                StrokeShape="RoundRectangle 12"
                Padding="12"
                IsVisible="{Binding ShowEnergyWindows}">
                <VerticalStackLayout Spacing="8">
                    <Label Text="Energy Windows" Style="{DynamicResource SectionTitle}" />
                    <Label Text="{Binding EnergyWindowsMessage}" Style="{DynamicResource CaptionText}" />
                    <Button
                        Text="ⓘ Why am I seeing this?"
                        BackgroundColor="Transparent"
                        TextColor="{DynamicResource AccentGreen}"
                        FontSize="12"
                        Padding="0"
                        Command="{Binding ShowEnergyWindowsInfoCommand}" />
                </VerticalStackLayout>
            </Border>

            <!-- Gentle tips -->
            <VerticalStackLayout Spacing="8" IsVisible="{Binding HasTips}">
                <Label Text="Gentle tips" Style="{DynamicResource SectionTitle}" />
                <Label
                    Text="{Binding TipFeedbackStatusText}"
                    Style="{DynamicResource CaptionText}"
                    IsVisible="{Binding HasTipFeedbackStatus}" />
                <CollectionView ItemsSource="{Binding Tips}">
                    <CollectionView.ItemTemplate>
                        <DataTemplate>
                            <Border
                                BackgroundColor="{AppThemeBinding Light={DynamicResource SoothingMint}, Dark={DynamicResource Gray900}}"
                                StrokeShape="RoundRectangle 10"
                                Padding="12"
                                Margin="0,0,0,8">
                                <VerticalStackLayout Spacing="6">
                                    <Label Text="{Binding Message}" Style="{DynamicResource CaptionText}" />
                                    <Button
                                        Text="Helpful"
                                        Style="{DynamicResource TipFeedbackButton}"
                                        HorizontalOptions="Start"
                                        Command="{Binding Path=BindingContext.MarkTipHelpfulCommand, Source={RelativeSource AncestorType={x:Type ContentPage}}}"
                                        CommandParameter="{Binding .}" />
                                </VerticalStackLayout>
                            </Border>
                        </DataTemplate>
                    </CollectionView.ItemTemplate>
                </CollectionView>
            </VerticalStackLayout>

            <!-- Gentle reminder -->
            <Border
                BackgroundColor="{AppThemeBinding Light={DynamicResource Gray100}, Dark={DynamicResource Gray900}}"
                StrokeShape="RoundRectangle 12"
                Padding="12">
                <VerticalStackLayout Spacing="8">
                    <Label Text="A gentle reminder" Style="{DynamicResource SectionTitle}" />
                    <Label Text="A tiny nudge to notice one small good thing." Style="{DynamicResource CaptionText}" />
                    <Button Text="{Binding GentleReminderButtonText}" Command="{Binding OpenGentleReminderCommand}" />
                    <Label
                        Text="{Binding GentleReminderStatusText}"
                        Style="{DynamicResource CaptionText}"
                        IsVisible="{Binding IsGentleReminderEnabled}" />
                </VerticalStackLayout>
            </Border>

            <!-- Heavy note -->
            <Border
                BackgroundColor="{AppThemeBinding Light={DynamicResource Gray100}, Dark={DynamicResource Gray900}}"
                StrokeShape="RoundRectangle 12"
                Padding="12">
                <VerticalStackLayout Spacing="8">
                    <Label
                        Text="Want to note anything that made today feel heavier?"
                        Style="{DynamicResource SectionTitle}"
                        FontSize="18" />
                    <Editor
                        Text="{Binding HeavyNoteText}"
                        AutoSize="TextChanges"
                        Placeholder="Example: Work stuff felt heavy. Didn't sleep great."
                        MaxLength="800"
                        HeightRequest="120" />
                    <Label
                        Text="{Binding HeavyNoteSavedLabel}"
                        IsVisible="{Binding HasHeavyNote}"
                        FontSize="12"
                        TextColor="{DynamicResource Gray500}" />
                    <Button
                        Text="Clear"
                        Style="{DynamicResource SecondaryButton}"
                        Command="{Binding ClearHeavyNoteCommand}"
                        HorizontalOptions="Start" />
                </VerticalStackLayout>
            </Border>

            <!-- Today's rhythm -->
            <Border
                BackgroundColor="{AppThemeBinding Light={DynamicResource Secondary}, Dark={DynamicResource Gray900}}"
                StrokeShape="RoundRectangle 12"
                Padding="16"
                IsVisible="{Binding HasTodayRhythm}">
                <Grid ColumnDefinitions="*,Auto" ColumnSpacing="16" RowDefinitions="Auto" VerticalOptions="Center">
                    <VerticalStackLayout Spacing="6">
                        <Label Text="Today's balance" Style="{DynamicResource SectionTitle}" />
                        <Label
                            Text="{Binding TodayRhythmDescriptor}"
                            TextColor="{Binding TodayRhythmColor}"
                            FontAttributes="Bold"
                            FontSize="14" />
                        <Label Text="{Binding TodayRhythmNote}" Style="{DynamicResource CaptionText}" />
                    </VerticalStackLayout>
                    <Grid Grid.Column="1" WidthRequest="90" HeightRequest="90">
                        <controls:TodayRhythmGauge
                            WidthRequest="90"
                            HeightRequest="90"
                            Value="{Binding TodayRhythmValue}"
                            AccentColor="{Binding TodayRhythmColor}"
                            TrackColor="{AppThemeBinding Light={DynamicResource Gray200}, Dark={DynamicResource Gray600}}" />
                        <Label
                            Text="{Binding TodayRhythmPercent}"
                            TextColor="{Binding TodayRhythmColor}"
                            FontAttributes="Bold"
                            FontSize="16"
                            HorizontalTextAlignment="Center"
                            VerticalTextAlignment="Center" />
                    </Grid>
                </Grid>
            </Border>

            <!-- Resource links -->
            <VerticalStackLayout Spacing="8" IsVisible="{Binding HasLinks}">
                <Label Text="Learn more" Style="{DynamicResource SectionTitle}" />
                <ScrollView Orientation="Horizontal">
                    <HorizontalStackLayout
                        Spacing="8"
                        BindableLayout.ItemsSource="{Binding Links}">
                        <BindableLayout.ItemTemplate>
                            <DataTemplate>
                                <Button
                                    Text="{Binding Title}"
                                    Style="{DynamicResource LinkButton}"
                                    HeightRequest="36"
                                    Command="{Binding BindingContext.OpenLinkCommand, Source={x:Reference HomePageView}}"
                                    CommandParameter="{Binding .}" />
                            </DataTemplate>
                        </BindableLayout.ItemTemplate>
                    </HorizontalStackLayout>
                </ScrollView>
            </VerticalStackLayout>
            </VerticalStackLayout>
        </ScrollView>
    </Grid>
</ContentPage>
